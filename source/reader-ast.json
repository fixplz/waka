{
  "rules": [
    {
      "name": "Start",
      "def": {
        "format": "{rules: rules, init: init, }",
        "of": {
          "seq": [
            {
              "ref": "sp"
            },
            {
              "opt": {
                "ref": "JSEmbed"
              },
              "bind": "init"
            },
            {
              "many": {
                "ref": "Rule"
              },
              "bind": "rules"
            }
          ]
        }
      }
    },
    {
      "name": "Rule",
      "def": {
        "format": "{name: name, def: def }",
        "of": {
          "seq": [
            {
              "ref": "RuleHead",
              "bind": "name"
            },
            {
              "ref": "eq"
            },
            {
              "ref": "Expr",
              "bind": "def"
            },
            {
              "ref": "semi"
            }
          ]
        }
      }
    },
    {
      "name": "RuleHead",
      "def": {
        "format": "n ",
        "of": {
          "seq": [
            {
              "ref": "word",
              "bind": "n"
            },
            {
              "ref": "sp"
            }
          ]
        }
      }
    },
    {
      "name": "Expr",
      "def": {
        "format": "r ",
        "of": {
          "seq": [
            {
              "ref": "ExprAction",
              "bind": "left"
            },
            {
              "alt": [
                {
                  "format": "{alt: [left].concat(tail) }",
                  "of": {
                    "many": {
                      "format": "e",
                      "of": {
                        "seq": [
                          {
                            "ref": "slash"
                          },
                          {
                            "ref": "ExprAction",
                            "bind": "e"
                          }
                        ]
                      }
                    },
                    "bind": "tail"
                  }
                },
                {
                  "format": "left "
                }
              ],
              "bind": "r"
            }
          ]
        }
      }
    },
    {
      "name": "ExprAction",
      "def": {
        "format": "r ",
        "of": {
          "seq": [
            {
              "ref": "ExprSeq",
              "bind": "body"
            },
            {
              "alt": [
                {
                  "format": "{format: isobj ? '{' + format + '}' : format, of: body }",
                  "of": {
                    "seq": [
                      {
                        "ref": "JSIsObj",
                        "bind": "isobj"
                      },
                      {
                        "ref": "JSEmbed",
                        "bind": "format"
                      }
                    ]
                  }
                },
                {
                  "format": "body "
                }
              ],
              "bind": "r"
            }
          ]
        }
      }
    },
    {
      "name": "ExprSeq",
      "def": {
        "format": "asSeq(atoms) ",
        "of": {
          "any": {
            "ref": "ExprAtom"
          },
          "bind": "atoms"
        }
      }
    },
    {
      "name": "ExprAtom",
      "def": {
        "alt": [
          {
            "format": "atom(bind, expr, op) ",
            "of": {
              "seq": [
                {
                  "opt": {
                    "format": "n",
                    "of": {
                      "seq": [
                        {
                          "ref": "word",
                          "bind": "n"
                        },
                        {
                          "ref": "col"
                        }
                      ]
                    }
                  },
                  "bind": "bind"
                },
                {
                  "alt": [
                    {
                      "ref": "Ref"
                    },
                    {
                      "ref": "Range"
                    },
                    {
                      "ref": "Literal"
                    },
                    {
                      "ref": "ExprParens"
                    }
                  ],
                  "bind": "expr"
                },
                {
                  "opt": {
                    "range": [
                      {
                        "oneof": "?*+"
                      }
                    ],
                    "not": false
                  },
                  "bind": "op"
                },
                {
                  "ref": "sp"
                }
              ]
            }
          },
          {
            "format": "{lookahead: expr, not: op == '!' }",
            "of": {
              "seq": [
                {
                  "range": [
                    {
                      "oneof": "&!"
                    }
                  ],
                  "not": false,
                  "bind": "op"
                },
                {
                  "alt": [
                    {
                      "ref": "Ref"
                    },
                    {
                      "ref": "Range"
                    },
                    {
                      "ref": "Literal"
                    },
                    {
                      "ref": "ExprParens"
                    }
                  ],
                  "bind": "expr"
                },
                {
                  "ref": "sp"
                }
              ]
            }
          }
        ]
      }
    },
    {
      "name": "Ref",
      "def": {
        "format": "{ref: n }",
        "of": {
          "ref": "word",
          "bind": "n"
        }
      }
    },
    {
      "name": "Literal",
      "def": {
        "format": "{str: s }",
        "of": {
          "ref": "str",
          "bind": "s"
        }
      }
    },
    {
      "name": "ExprParens",
      "def": {
        "format": "e ",
        "of": {
          "seq": [
            {
              "str": "("
            },
            {
              "ref": "sp"
            },
            {
              "ref": "Expr",
              "bind": "e"
            },
            {
              "str": ")"
            }
          ]
        }
      }
    },
    {
      "name": "Range",
      "def": {
        "format": "{range: rs, not: not == '^' }",
        "of": {
          "seq": [
            {
              "str": "["
            },
            {
              "opt": {
                "str": "^"
              },
              "bind": "not"
            },
            {
              "ref": "sp"
            },
            {
              "any": {
                "alt": [
                  {
                    "format": "{from: from, to: to }",
                    "of": {
                      "seq": [
                        {
                          "ref": "rangechar",
                          "bind": "from"
                        },
                        {
                          "str": "-"
                        },
                        {
                          "ref": "rangechar",
                          "bind": "to"
                        },
                        {
                          "ref": "sp"
                        }
                      ]
                    }
                  },
                  {
                    "format": "{oneof: cat(chars) }",
                    "of": {
                      "many": {
                        "format": "cat(c) ",
                        "of": {
                          "seq": [
                            {
                              "many": {
                                "ref": "rangechar"
                              },
                              "bind": "c"
                            },
                            {
                              "ref": "sp"
                            }
                          ]
                        }
                      },
                      "bind": "chars"
                    }
                  }
                ]
              },
              "bind": "rs"
            },
            {
              "str": "]"
            }
          ]
        }
      }
    },
    {
      "name": "rangechar",
      "def": {
        "alt": [
          {
            "seq": [
              {
                "str": "\\\\"
              },
              {
                "ref": "any"
              }
            ]
          },
          {
            "range": [
              {
                "oneof": "\\[\\] "
              }
            ],
            "not": true
          }
        ]
      }
    },
    {
      "name": "JSEmbed",
      "def": {
        "format": "e ",
        "of": {
          "seq": [
            {
              "str": "{"
            },
            {
              "ref": "sp"
            },
            {
              "ref": "embed",
              "bind": "e"
            },
            {
              "str": "}"
            },
            {
              "ref": "sp"
            }
          ]
        }
      }
    },
    {
      "name": "JSIsObj",
      "def": {
        "alt": [
          {
            "format": "true ",
            "of": {
              "lookahead": {
                "seq": [
                  {
                    "str": "{"
                  },
                  {
                    "ref": "sp"
                  },
                  {
                    "ref": "word"
                  },
                  {
                    "ref": "sp"
                  },
                  {
                    "ref": "col"
                  }
                ]
              },
              "not": false
            }
          },
          {
            "format": "false "
          }
        ]
      }
    },
    {
      "name": "word",
      "def": {
        "seq": [
          {
            "range": [
              {
                "from": "a",
                "to": "z"
              },
              {
                "from": "A",
                "to": "Z"
              },
              {
                "oneof": "_"
              }
            ],
            "not": false
          },
          {
            "any": {
              "range": [
                {
                  "from": "a",
                  "to": "z"
                },
                {
                  "from": "A",
                  "to": "Z"
                },
                {
                  "from": "0",
                  "to": "9"
                },
                {
                  "oneof": "_"
                }
              ],
              "not": false
            }
          }
        ]
      }
    },
    {
      "name": "str",
      "def": {
        "alt": [
          {
            "format": "x ",
            "of": {
              "seq": [
                {
                  "range": [
                    {
                      "oneof": "\""
                    }
                  ],
                  "not": false
                },
                {
                  "any": {
                    "alt": [
                      {
                        "seq": [
                          {
                            "str": "\\\\"
                          },
                          {
                            "ref": "any"
                          }
                        ]
                      },
                      {
                        "range": [
                          {
                            "oneof": "\""
                          }
                        ],
                        "not": true
                      }
                    ]
                  },
                  "bind": "x"
                },
                {
                  "range": [
                    {
                      "oneof": "\""
                    }
                  ],
                  "not": false
                }
              ]
            }
          },
          {
            "format": "x ",
            "of": {
              "seq": [
                {
                  "range": [
                    {
                      "oneof": "'"
                    }
                  ],
                  "not": false
                },
                {
                  "any": {
                    "alt": [
                      {
                        "seq": [
                          {
                            "str": "\\\\"
                          },
                          {
                            "ref": "any"
                          }
                        ]
                      },
                      {
                        "range": [
                          {
                            "oneof": "'"
                          }
                        ],
                        "not": true
                      }
                    ]
                  },
                  "bind": "x"
                },
                {
                  "range": [
                    {
                      "oneof": "'"
                    }
                  ],
                  "not": false
                }
              ]
            }
          }
        ]
      }
    },
    {
      "name": "embed",
      "def": {
        "seq": [
          {
            "any": {
              "range": [
                {
                  "oneof": "{}"
                }
              ],
              "not": true
            }
          },
          {
            "any": {
              "seq": [
                {
                  "str": "{"
                },
                {
                  "ref": "embed"
                },
                {
                  "str": "}"
                },
                {
                  "any": {
                    "range": [
                      {
                        "oneof": "{}"
                      }
                    ],
                    "not": true
                  }
                }
              ]
            }
          }
        ]
      }
    },
    {
      "name": "eq",
      "def": {
        "seq": [
          {
            "str": "="
          },
          {
            "ref": "sp"
          }
        ]
      }
    },
    {
      "name": "slash",
      "def": {
        "seq": [
          {
            "str": "/"
          },
          {
            "ref": "sp"
          }
        ]
      }
    },
    {
      "name": "semi",
      "def": {
        "seq": [
          {
            "str": ";"
          },
          {
            "ref": "sp"
          }
        ]
      }
    },
    {
      "name": "col",
      "def": {
        "seq": [
          {
            "str": ":"
          },
          {
            "ref": "sp"
          }
        ]
      }
    },
    {
      "name": "any",
      "def": {
        "format": "_P.step(true) "
      }
    },
    {
      "name": "sp",
      "def": {
        "any": {
          "range": [
            {
              "oneof": "\\r\\n\\ "
            }
          ],
          "not": false
        }
      }
    },
    {
      "name": "lsp",
      "def": {
        "any": {
          "alt": [
            {
              "many": {
                "range": [
                  {
                    "oneof": "\\r\\n\\ "
                  }
                ],
                "not": false
              }
            },
            {
              "seq": [
                {
                  "str": "//"
                },
                {
                  "any": {
                    "range": [
                      {
                        "oneof": "\\n"
                      }
                    ],
                    "not": true
                  }
                },
                {
                  "str": "\\n"
                }
              ]
            }
          ]
        }
      }
    }
  ],
  "init": "function asSeq(atoms) {\n    if(atoms.length > 1) return { seq: atoms }\n    return atoms[0]\n  }\n  function atom(bind, expr, op) {\n    var el =\n      op == '+' ? { many: expr }\n      : op == '*' ? { any: expr }\n      : op == '?' ? { opt: expr }\n      : expr\n    if(bind) el.bind = bind\n    return el\n  }\n  function cat(arr) {\n    return arr.join('')\n  }\n"
}